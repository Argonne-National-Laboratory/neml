name: Make test packages

on: pull_request

jobs:
      deploy_linux_test:
            runs-on: ubuntu-latest
            container: quay.io/pypa/manylinux2014_x86_64
            steps:
            - uses: actions/checkout@v2
            - name: Install dependencies
              run: |
                    yum -y install cmake blas-devel lapack-devel
            - name: Build sdist
              run: |
                    python setup.py sdist
            - name: Build manylinux wheel
              run: |
                    python setup.py bdist_wheel
                    auditwheel repair dist/*.whl
            - name: Upload to Test PyPi
              uses: pypa/gh-action-pypi-publish@master
              with:
                    password: ${{ secrets.PIPY_TEST_PASSWORD }}
                    repository_url: https://test.pypi.org/legacy/
